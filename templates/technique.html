{% extends "base.html" %}

{% block content %}

<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/technique.css') }}">
</head>

<a class="back-link" href="{{ url_for('routes.mitre_tactic', tactic=technique.tactic.replace(' ', '_')) }}">
    ⬅️ Back to {{ technique.tactic }}
</a>

<h1>{{ technique.title }} [{{ technique.id }}]</h1>

<div class="links">
    <a href="https://d3fend.mitre.org/offensive-technique/attack/{{ technique.id }}" class="btn">🛡️ MITRE D3FEND</a>
    <a href="https://attack.mitre.org/techniques/{{ technique.id }}" class="btn">⚔️ MITRE ATT&CK</a>
</div>

<hr/>

<h2>🔍 ACCESS</h2>
<div class="info-box">
    <p><strong>Objective:</strong> {{ technique.objective }}</p>
    <p><strong>Scope:</strong> {{ technique.scope }}</p>
    <p><strong>Threat Model:</strong> {{ technique.threat_model }}</p>
    <ul>
        {% for question in technique.hypothesis %}
        <li>❓ {{ question }}</li>
        {% endfor %}
    </ul>
</div>

<h2>🛠 Data Sources & Log Queries</h2>
<div class="info-box">
    <p><strong>Data Sources:</strong> {{ technique.data_sources }}</p>
    <p><strong>Protocol:</strong> {{ technique.protocol }}</p>
    <p><strong>OS:</strong> {{ technique.os }}</p>
</div>

<table>
    <tr><th>Log Type</th><th>Source</th></tr>
    {% for log in technique.log_sources %}
    <tr><td>{{ log.type }}</td><td>{{ log.source }}</td></tr>
    {% endfor %}
</table>

<h2>🕵️ HUNT</h2>
<div class="links">
    <a href="{{ technique.spl_rule }}" class="btn">🔍 SPL</a>
    <a href="{{ technique.elastic_rule }}" class="btn">🔍 Elastic</a>
    <a href="https://grep.app/search?f.repo=SigmaHQ%2Fsigma&q={{ technique.id }}" class="btn">🔍 Sigma</a>
</div>

<h3>🛠 Detection Methods</h3>
<ul class="detection-list">
    {% for method in technique.detection_methods %}
    <li>📌 {{ method }}</li>
    {% endfor %}
</ul>

<table>
    <tr><th>🔍 SPL - Detect {{ technique.title }}</th></tr>
    {% for query in technique.spl_query %}
    <tr><td>{{ query }}</td></tr>
    {% endfor %}
</table>

<h3>🛠 Hunt Execution Steps</h3>
<ol>
    {% for step in technique.hunt_steps %}
    <li>🚀 {{ step }}</li>
    {% endfor %}
</ol>

<h2><a href="https://center-for-threat-informed-defense.github.io/technique-inference-engine/">MITRE ATT&CK Mapping</a></h2>
<table>
    <tr><th>Tactic</th><th>Technique</th><th>Example</th></tr>
    {% for mapping in technique.mitre_mapping %}
    <tr>
        <td>{{ mapping.tactic }}</td>
        <td><a href="https://attack.mitre.org/techniques/{{ technique.id }}">{{ mapping.technique }}</a></td>
        <td>{{ mapping.example }}</td>
    </tr>
    {% endfor %}
</table>

<h2>🧹 CLEAR</h2>
<ul>
    {% for clear in technique.clearing_steps %}
    <li>🧼 {{ clear }}</li>
    {% endfor %}
</ul>

<h2>🛡️ HARDEN</h2>
<ul>
    {% for outcome in technique.expected_outcomes %}
    <li>🔒 {{ outcome }}</li>
    {% endfor %}
</ul>

<h3>📌 Enhance Defenses</h3>
<ul>
    {% for defense in technique.enhancements %}
    <li>🛠️ {{ defense }}</li>
    {% endfor %}
</ul>

<h2>📖 LESSONS LEARNED</h2>
<h3>🚀 Watchlist & Alerting</h3>
<ul>
    {% for alert in technique.watchlist %}
    <li>📢 {{ alert }}</li>
    {% endfor %}
</ul>

<h3>📊 Summary & Reporting</h3>
<ul>
    <li><strong>Summary of Findings:</strong> {{ technique.summary }}</li>
    <li><strong>Remediation Steps:</strong> {{ technique.remediation }}</li>
    <li><strong>Future Improvements:</strong> {{ technique.improvements }}</li>
</ul>

<a class="back-link" href="{{ url_for('routes.mitre_tactic', tactic=technique.tactic.replace(' ', '_')) }}">
    ⬅️ Back to {{ technique.tactic }}
</a>

<!-- Go to Top Button -->
<button onclick="scrollToTop()" id="topBtn" class="top-btn">⬆️ Go to Top</button>

<!-- JavaScript for Smooth Scroll & Visibility -->
<script>
    // Smooth Scroll to Top
    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Show/hide button on scroll
    window.onscroll = function() { toggleScrollButton() };

    function toggleScrollButton() {
        let topBtn = document.getElementById("topBtn");
        if (document.documentElement.scrollTop > 200) {
            topBtn.style.display = "block";
        } else {
            topBtn.style.display = "none";
        }
    }
</script>


{% endblock %}